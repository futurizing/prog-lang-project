!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ProgLangCompiler=e.ProgLangCompiler||{})}(this,function(e){"use strict";var t;!function(e){e[e.Plus=0]="Plus",e[e.And=1]="And",e[e.As=2]="As",e[e.BooleanValueFalse=3]="BooleanValueFalse",e[e.BooleanValueTrue=4]="BooleanValueTrue",e[e.ButIf=5]="ButIf",e[e.By=6]="By",e[e.Comma=7]="Comma",e[e.Decrease=8]="Decrease",e[e.Divide=9]="Divide",e[e.Do=10]="Do",e[e.EndOfFile=11]="EndOfFile",e[e.EndOfFor=12]="EndOfFor",e[e.EndOfFunction=13]="EndOfFunction",e[e.EndOfIf=14]="EndOfIf",e[e.EndOfWhile=15]="EndOfWhile",e[e.EqualTo=16]="EqualTo",e[e.For=17]="For",e[e.From=18]="From",e[e.FunctionDeclaration=19]="FunctionDeclaration",e[e.GreaterThan=20]="GreaterThan",e[e.GreaterThanOrEqualTo=21]="GreaterThanOrEqualTo",e[e.If=22]="If",e[e.Increase=23]="Increase",e[e.LessThan=24]="LessThan",e[e.LessThanOrEqualTo=25]="LessThanOrEqualTo",e[e.Minus=26]="Minus",e[e.Modulo=27]="Modulo",e[e.Multiply=28]="Multiply",e[e.Mutable=29]="Mutable",e[e.Not=30]="Not",e[e.NotEqualTo=31]="NotEqualTo",e[e.Or=32]="Or",e[e.Otherwise=33]="Otherwise",e[e.Print=34]="Print",e[e.Set=35]="Set",e[e.To=36]="To",e[e.ToBe=37]="ToBe",e[e.VariableDeclaration=38]="VariableDeclaration",e[e.InitializedTo=39]="InitializedTo",e[e.VariableTypeBoolean=40]="VariableTypeBoolean",e[e.VariableTypeNumber=41]="VariableTypeNumber",e[e.VariableTypeString=42]="VariableTypeString",e[e.While=43]="While",e[e.WithParam=44]="WithParam"}(t||(t={}));var r,o=[{matcher:"plus",tokenType:t.Plus},{matcher:"and",tokenType:t.And},{matcher:"as",tokenType:t.As},{matcher:"boolean",tokenType:t.VariableTypeBoolean},{matcher:"but if",tokenType:t.ButIf},{matcher:"by",tokenType:t.By},{matcher:"comma",tokenType:t.Comma},{matcher:"decrease",tokenType:t.Decrease},{matcher:"define function",tokenType:t.FunctionDeclaration},{matcher:"define variable",tokenType:t.VariableDeclaration},{matcher:"divide",tokenType:t.Divide},{matcher:"do",tokenType:t.Do},{matcher:"end of for",tokenType:t.EndOfFor},{matcher:"end of function",tokenType:t.EndOfFunction},{matcher:"end of if",tokenType:t.EndOfIf},{matcher:"end of while",tokenType:t.EndOfWhile},{matcher:"equal to",tokenType:t.EqualTo},{matcher:"false",tokenType:t.BooleanValueFalse},{matcher:"for",tokenType:t.For},{matcher:"from",tokenType:t.From},{matcher:"greater than or equal to",tokenType:t.GreaterThanOrEqualTo},{matcher:"greater than",tokenType:t.GreaterThan},{matcher:"if",tokenType:t.If},{matcher:"increase",tokenType:t.Increase},{matcher:"initialized to",tokenType:t.InitializedTo},{matcher:"less than or equal to",tokenType:t.LessThanOrEqualTo},{matcher:"less than",tokenType:t.LessThan},{matcher:"minus",tokenType:t.Minus},{matcher:"modulo",tokenType:t.Modulo},{matcher:"multiply",tokenType:t.Multiply},{matcher:"mutable",tokenType:t.Mutable},{matcher:"not equal to",tokenType:t.NotEqualTo},{matcher:"not",tokenType:t.Not},{matcher:"number",tokenType:t.VariableTypeNumber},{matcher:"or",tokenType:t.Or},{matcher:"otherwise",tokenType:t.Otherwise},{matcher:"print",tokenType:t.Print},{matcher:"set",tokenType:t.Set},{matcher:"string",tokenType:t.VariableTypeString},{matcher:"to",tokenType:t.To},{matcher:"to be",tokenType:t.ToBe},{matcher:"true",tokenType:t.BooleanValueTrue},{matcher:"while",tokenType:t.While},{matcher:"with param",tokenType:t.WithParam}],a=function(){function e(e,t){void 0===t&&(t=o),this.sourceCode=e,this.rulesMap=new Map,this.position=0;for(var r=0,a=t;r<a.length;r++){var n=a[r];this.rulesMap.set(n.tokenType,n.matcher)}}return e.prototype.makeError=function(e,t){return new Error("Position: "+e+".\n"+t)},e.prototype.isEndOfFile=function(e){return void 0===e&&(e=this.position),e>=this.sourceCode.length},e.prototype.getNextNonWhitespacePosition=function(e){for(void 0===e&&(e=this.position);!this.isEndOfFile(e)&&/\s/.test(this.sourceCode.charAt(e))===!0;)e++;return e},e.prototype.getNextWhitespacePosition=function(e){for(void 0===e&&(e=this.position);!this.isEndOfFile(e)&&/\s/.test(this.sourceCode.charAt(e))===!1;)e++;return e},e.prototype.checkForMatch=function(e){for(var t=this.getNextNonWhitespacePosition(this.position),r=0;r<e.length;r++)if(" "===e.charAt(r))t=this.getNextNonWhitespacePosition(t);else{if(this.isEndOfFile(t)||this.sourceCode.charAt(t).toLowerCase()!==e.charAt(r))return{isMatch:!1};t++}var o=this.getNextNonWhitespacePosition(t);return o!==t||this.isEndOfFile(o)?{isMatch:!0,newPosition:o}:{isMatch:!1}},e.prototype.getNextTokenType=function(e){for(var r=this,o=0,a=e;o<a.length;o++){var n=a[o];if(n===t.EndOfFile){var i=this.getNextNonWhitespacePosition();if(this.isEndOfFile(i))return{token:n,nextPosition:i}}else{var s=this.rulesMap.get(n),c=this.checkForMatch(s);if(c.isMatch===!0)return{token:n,nextPosition:c.newPosition}}}var h=e.map(function(e){return e===t.EndOfFile?"EOF":r.rulesMap.get(e)}).join(" | ");throw this.makeError(this.position,"Expected: "+h+".")},e.prototype.peekNextTokenType=function(e){try{return this.getNextTokenType(e).token}catch(e){return!1}},e.prototype.extractTokenType=function(e){var t=this.getNextTokenType(e);return this.position=t.nextPosition,t.token},e.prototype.getNextTokenAsString=function(){var e=this.getNextNonWhitespacePosition();if(this.isEndOfFile(e))throw this.makeError(e,"Expected a token.");var t=this.getNextWhitespacePosition(e);return{token:this.sourceCode.slice(e,t),nextPosition:t}},e.prototype.extractNextTokenAsString=function(){var e=this.getNextTokenAsString();return this.position=e.nextPosition,e.token},e.prototype.peekNextTokenAsString=function(){try{return this.getNextTokenAsString().token}catch(e){return!1}},e.prototype.extractStringLiteral=function(){var e=this.getNextNonWhitespacePosition();if(this.isEndOfFile(e))return!1;var t=this.sourceCode.charAt(e);if("'"!==t&&'"'!==t&&"`"!==t)return!1;for(var r=e;;){if(r++,this.isEndOfFile(r))return!1;var o=this.sourceCode.charAt(r);if(o===t)return this.position=r+1,this.sourceCode.slice(e+1,r)}},e}();!function(e){e[e.Plus=0]="Plus",e[e.And=1]="And",e[e.Divide=2]="Divide",e[e.EqualTo=3]="EqualTo",e[e.GreaterThan=4]="GreaterThan",e[e.GreaterThanOrEqualTo=5]="GreaterThanOrEqualTo",e[e.LessThan=6]="LessThan",e[e.LessThanOrEqualTo=7]="LessThanOrEqualTo",e[e.Minus=8]="Minus",e[e.Modulo=9]="Modulo",e[e.Multiply=10]="Multiply",e[e.Not=11]="Not",e[e.NotEqualTo=12]="NotEqualTo",e[e.Or=13]="Or"}(r||(r={}));var n;!function(e){e[e.Number=0]="Number",e[e.String=1]="String",e[e.Boolean=2]="Boolean"}(n||(n={}));var i=[t.VariableDeclaration,t.Set,t.Increase,t.Decrease,t.Multiply,t.Divide,t.Print,t.If,t.While,t.For],s=i.concat([t.FunctionDeclaration,t.EndOfFile]),c=[t.VariableTypeNumber,t.VariableTypeString,t.VariableTypeBoolean],h=[t.BooleanValueTrue,t.BooleanValueFalse],p=[t.Plus,t.And,t.Divide,t.EqualTo,t.GreaterThan,t.GreaterThanOrEqualTo,t.LessThan,t.LessThanOrEqualTo,t.Minus,t.Modulo,t.Multiply,t.NotEqualTo,t.Or],l=function(){function e(e){this.tokenizer=e}return e.parseSourceCode=function(t){var r=new a(t),o=new e(r);return o.parse()},e.prototype.createErrorInvalidToken=function(e,r){return void 0===r&&(r=""),new Error(("Invalid token "+t[e]+". "+r).trim())},e.prototype.parse=function(){for(var e={instructions:[]};;){var r=this.tokenizer.extractTokenType(s);if(r===t.FunctionDeclaration)e.instructions.push(this.createFunction());else{if(r===t.EndOfFile)break;e.instructions.push(this.createStatement(r))}}return e},e.prototype.createFunction=function(){throw this.createErrorInvalidToken(t.FunctionDeclaration,"Function is not supported yet.")},e.prototype.createExpressionAtom=function(){var e=this.tokenizer.peekNextTokenType(h);if(e!==!1){this.tokenizer.extractTokenType(h);var r={type:"ExpressionAtom",atomType:"Boolean",value:e===t.BooleanValueTrue};return r}var o=this.tokenizer.peekNextTokenAsString();if(o!==!1){if(/^-?([0-9]*\.[0-9]+|[0-9]+)$/.test(o)){this.tokenizer.extractNextTokenAsString();var a={type:"ExpressionAtom",atomType:"Number",value:o};return a}if(/^[a-zA-Z0-9-_]+$/.test(o)){this.tokenizer.extractNextTokenAsString();var n={type:"ExpressionAtom",atomType:"Variable",variableName:o};return n}}var i=this.tokenizer.extractStringLiteral();if(i===!1)throw new Error("Invalid expression.");var s={type:"ExpressionAtom",atomType:"String",value:i};return s},e.prototype.createExpression=function(){var e=this.tokenizer.peekNextTokenType([t.Not]);if(e!==!1){this.tokenizer.extractTokenType([t.Not]);var o={type:"Expression",operand:r.Not,rightValue:this.createExpression()};return o}var a=this.createExpressionAtom(),n=this.tokenizer.peekNextTokenType(p);if(n!==!1){var i=void 0;switch(n){case t.Plus:i=r.Plus;break;case t.And:i=r.And;break;case t.Divide:i=r.Divide;break;case t.EqualTo:i=r.EqualTo;break;case t.GreaterThan:i=r.GreaterThan;break;case t.GreaterThanOrEqualTo:i=r.GreaterThanOrEqualTo;break;case t.LessThan:i=r.LessThan;break;case t.LessThanOrEqualTo:i=r.LessThanOrEqualTo;break;case t.Minus:i=r.Minus;break;case t.Modulo:i=r.Modulo;break;case t.Multiply:i=r.Multiply;break;case t.NotEqualTo:i=r.NotEqualTo;break;case t.Or:i=r.Or;break;default:throw this.createErrorInvalidToken(n)}this.tokenizer.extractTokenType(p);var s={type:"Expression",leftValue:a,operator:i,rightValue:this.createExpression()};return s}return a},e.prototype.createVariableDeclaration=function(){var e=this.tokenizer.extractNextTokenAsString();this.tokenizer.extractTokenType([t.ToBe]);var r=!1,o=void 0,a=void 0,i=this.tokenizer.extractTokenType([t.EqualTo,t.InitializedTo,t.Mutable].concat(c));if(i===t.Mutable){r=!0;var s=this.tokenizer.extractTokenType(c);switch(s){case t.VariableTypeNumber:o=n.Number;break;case t.VariableTypeString:o=n.String;break;case t.VariableTypeBoolean:o=n.Boolean;break;default:throw this.createErrorInvalidToken(s)}}else i===t.VariableTypeNumber?o=n.Number:i===t.VariableTypeString?o=n.String:i===t.VariableTypeBoolean&&(o=n.Boolean);if(i===t.Mutable||i===t.VariableTypeNumber||i===t.VariableTypeString||i===t.VariableTypeBoolean){var h=[t.EqualTo,t.InitializedTo];this.tokenizer.peekNextTokenType(h)!==!1&&(i=this.tokenizer.extractTokenType(h))}return i!==t.EqualTo&&i!==t.InitializedTo||(a=this.createExpression()),{type:"VariableDeclaration",variableName:e,variableType:o,isMutable:r,value:a}},e.prototype.createAssignment=function(e){var r=this.tokenizer.extractNextTokenAsString();e===t.Set?this.tokenizer.extractTokenType([t.ToBe]):this.tokenizer.extractTokenType([t.By]);var o=this.createExpression();switch(e){case t.Set:var a={type:"AssignmentSet",variableName:r,value:o};return a;case t.Increase:var a={type:"AssignmentIncrease",variableName:r,value:o};return a;case t.Decrease:var a={type:"AssignmentDecrease",variableName:r,value:o};return a}throw this.createErrorInvalidToken(e)},e.prototype.createPrintStatement=function(){return{type:"PrintStatement",value:this.createExpression()}},e.prototype.createWhileLoop=function(){var e=this.createExpression();this.tokenizer.extractTokenType([t.Do]);var r=this.createStatements();return this.tokenizer.extractTokenType([t.EndOfWhile]),{type:"WhileBlock",condition:e,statements:r}},e.prototype.createForLoop=function(){var e=this.tokenizer.extractNextTokenAsString();this.tokenizer.extractTokenType([t.From]);var r=this.createExpression();this.tokenizer.extractTokenType([t.To]);var o=this.createExpression();this.tokenizer.extractTokenType([t.Do]);var a=this.createStatements();return this.tokenizer.extractTokenType([t.EndOfFor]),{type:"ForBlock",iteratorName:e,iteratorFrom:r,iteratorTo:o,statements:a}},e.prototype.createIfBlock=function(){var e=this.createExpression();this.tokenizer.extractTokenType([t.Do]);for(var r=this.createStatements(),o=[{condition:e,statements:r}],a=void 0;;){var n=this.tokenizer.peekNextTokenType([t.ButIf,t.Otherwise]);if(n!==t.ButIf){if(n===t.Otherwise){this.tokenizer.extractTokenType([t.Otherwise]),this.tokenizer.extractTokenType([t.Do]),a=this.createStatements();break}break}this.tokenizer.extractTokenType([t.ButIf]);var i=this.createExpression();this.tokenizer.extractTokenType([t.Do]);var s=this.createStatements();o.push({condition:i,statements:s})}return this.tokenizer.extractTokenType([t.EndOfIf]),{type:"IfBlock",ifBlocks:o,elseBlockStatements:a}},e.prototype.createStatements=function(){for(var e=[this.createStatement()];;){var t=this.tokenizer.peekNextTokenType(i);if(t===!1)break;e.push(this.createStatement(this.tokenizer.extractTokenType(i)))}return e},e.prototype.createStatement=function(e){switch(void 0===e&&(e=this.tokenizer.extractTokenType(i)),e){case t.VariableDeclaration:return this.createVariableDeclaration();case t.Set:case t.Increase:case t.Decrease:return this.createAssignment(e);case t.Print:return this.createPrintStatement();case t.If:return this.createIfBlock();case t.While:return this.createWhileLoop();case t.For:return this.createForLoop()}throw this.createErrorInvalidToken(e)},e}();e.Parser=l,Object.defineProperty(e,"__esModule",{value:!0})});